<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
    <Description>ASP.NET Core Identity UI is the default Razor Pages built-in UI for the ASP.NET Core Identity framework.</Description>
    <RazorAssemblyDescription>Compiled Razor views assembly for the ASP.NET Core Identity UI package.</RazorAssemblyDescription>
    <TargetFramework>$(DefaultNetCoreTargetFramework)</TargetFramework>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <PackageTags>aspnetcore;identity;membership;razorpages</PackageTags>
    <EnableDefaultRazorGenerateItems>false</EnableDefaultRazorGenerateItems>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>

    <DisableStaticWebAssetsBuildPropsFileGeneration>true</DisableStaticWebAssetsBuildPropsFileGeneration>
    <StaticWebAssetsDisableProjectBuildPropsFileGeneration>true</StaticWebAssetsDisableProjectBuildPropsFileGeneration>

    <PackageThirdPartyNoticesFile>$(MSBuildThisFileDirectory)THIRD-PARTY-NOTICES.TXT</PackageThirdPartyNoticesFile>
    <Nullable>disable</Nullable>
    <GetBuildAssetsTargets>_UpdateIdentityAssets;GetCurrentProjectBuildStaticWebAssetItems</GetBuildAssetsTargets>
  </PropertyGroup>

  <ItemGroup>
    <Content Remove="@(Content)" />
    <Content Include="wwwroot\**\*" Pack="true" />
    <None Include="build\*" Pack="true" PackagePath="build\" />
    <None Include="buildMultiTargeting\*" Pack="true" PackagePath="buildMultiTargeting\" />
    <None Include="buildTransitive\*" Pack="true" PackagePath="buildTransitive\" />
  </ItemGroup>

  <ItemGroup>
    <Reference Include="Microsoft.AspNetCore.Identity" />
    <Reference Include="Microsoft.AspNetCore.Mvc" />
    <Reference Include="Microsoft.AspNetCore.StaticFiles" />
    <Reference Include="Microsoft.Extensions.FileProviders.Embedded" />
    <Reference Include="Microsoft.Extensions.Identity.Stores" />
  </ItemGroup>

  <Target Name="SetupRazorInputs" BeforeTargets="ResolveRazorGenerateInputs">
    <ItemGroup>
      <_RazorGenerate Include="Areas\Identity\Pages\V5\**\*.cshtml" />

      <RazorGenerate Include="@(_RazorGenerate)" Link="Areas\Identity\Pages\%(RecursiveDir)%(Filename)%(Extension)" />
    </ItemGroup>
  </Target>

  <!-- This is only needed for tests and the tests will always look for V5 -->
  <Target Name="_UpdateIdentityAssets">
    <ItemGroup>
      <_IdentityUIAssets Include="@(StaticWebAsset)" Condition="'%(SourceId)' == 'Microsoft.AspNetCore.Identity.UI'">
        <ContentRoot>%(StaticWebAsset.ContentRoot)V5\</ContentRoot>
        <RelativePath>$([System.String]::Copy('%(StaticWebAsset.RelativePath)').Replace('V5/',''))</RelativePath>
      </_IdentityUIAssets>
      <StaticWebAsset Remove="@(_IdentityUIAssets)" />
      <StaticWebAsset Include="@(_IdentityUIAssets)" />
    </ItemGroup>
    </Target>

</Project>
